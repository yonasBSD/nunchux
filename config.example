# Nunchux Configuration
#
# Copy to: ~/.config/nunchux/config
# Fallback: ~/.nunchuxrc

[settings]
icon_running = ●
icon_stopped = ○
menu_width = 60%
menu_height = 50%
popup_width = 90%
popup_height = 90%
just_enabled = true
npm_enabled = true
fzf_prompt =
fzf_pointer = ▶
fzf_border = rounded
fzf_border_label =  nunchux
fzf_colors = fg+:white:bold,bg+:-1,hl:cyan,hl+:cyan:bold,pointer:cyan,marker:green,header:gray,border:gray

# Apps
# Each section defines an app. The section name becomes the window name.
#
# Available options:
#   cmd           = command to run (required)
#   desc          = description shown in menu
#   width         = popup width (e.g., 80 or 80%)
#   height        = popup height
#   status        = shell command for dynamic status
#   status_script = path to script for complex status
#   on_exit       = command to run after app exits
#
# Variables available in cmd and on_exit:
#   {pane_id}     = parent tmux pane ID
#   {tmp}         = fresh temp file path
#   {dir}         = starting directory
#
# Submenus:
#   Use [parent/child] section names to create submenus.
#   The parent appears in the main menu; selecting it opens the submenu.

[btop]
cmd = btop
status = load=$(cut -d' ' -f1 /proc/loadavg); \
         ram=$(awk '/MemAvailable/{printf "%.0f", $2/1024/1024}' /proc/meminfo); \
         disk=$(df /home --output=avail 2>/dev/null | tail -1 | awk '{printf "%.0f", $1/1024/1024}'); \
         echo "load: $load | ram: ${ram}GB free | /home: ${disk}GB free"

[htop]
cmd = htop
desc = Process viewer

[git]
cmd = lazygit
status = n=$(git status -s 2>/dev/null | wc -l | tr -d ' '); [[ $n -gt 0 ]] && echo "($n changed)"

[docker]
cmd = lazydocker
status = n=$(docker ps -q 2>/dev/null | wc -l | tr -d ' '); [[ $n -gt 0 ]] && echo "($n running)"

# [k9s]
# cmd = k9s
# status = ctx=$(kubectl config current-context 2>/dev/null); [[ -n "$ctx" ]] && echo "($ctx)"

# [files]
# # yazi doesn't work directly in tmux popups due to terminal passthrough issues.
# # Workaround: wrap in nvim terminal. See https://github.com/sxyazi/yazi/issues/2308
# cmd = nvim --clean -c 'set laststatus=0 cmdheight=0 noshowmode noruler signcolumn=no nonumber' -c 'terminal yazi --cwd-file={tmp}' -c 'startinsert' -c 'autocmd TermClose * qa!'
# desc = File manager
# # Only cd if pane is at a shell prompt (not in vim, etc.)
# on_exit = cwd=$(cat {tmp} 2>/dev/null); \
#   if [[ -d "$cwd" ]]; then \
#     cmd=$(tmux display-message -t {pane_id} -p '#{pane_current_command}'); \
#     [[ "$cmd" =~ ^(bash|zsh|fish|sh)$ ]] && tmux send-keys -t {pane_id} "cd \"$cwd\"" Enter; \
#   fi; \
#   rm -f {tmp}

# [notes]
# cmd = nvim ~/notes
# width = 80
# height = 60
# status = mins=$(( ($(date +%s) - $(stat -c %Y ~/notes 2>/dev/null || echo 0)) / 60 )); [[ $mins -lt 60 ]] && echo "(${mins}m ago)" || echo "($(($mins/60))h ago)"

# [todos]
# cmd = nvim ~/todos.md
# width = 70
# height = 50
# status = n=$(wc -l < ~/todos.md 2>/dev/null || echo 0); echo "($n lines)"

# Submenu example - these appear under "control" in the main menu
# [control/wifi]
# cmd = nmtui
# desc = WiFi settings
#
# [control/sound]
# cmd = pavucontrol
# desc = Audio mixer
#
# [control/display]
# cmd = arandr
# desc = Display settings
